{"version":3,"file":"index.esm.js","sources":["../../../dist/plugins/typescript/react-apollo-offix/src/visitor.js","../../../dist/plugins/typescript/react-apollo-offix/src/index.js"],"sourcesContent":["import { ClientSideBaseVisitor, DocumentMode, } from '@graphql-codegen/visitor-plugin-common';\nimport autoBind from 'auto-bind';\nimport { pascalCase } from 'pascal-case';\nexport class ReactApolloVisitor extends ClientSideBaseVisitor {\n    constructor(schema, fragments, rawConfig, documents) {\n        super(schema, fragments, rawConfig, {});\n        this.imports = new Set();\n        this._externalImportPrefix = this.config.importOperationTypesFrom ? `${this.config.importOperationTypesFrom}.` : '';\n        this._documents = documents;\n        autoBind(this);\n    }\n    getOffixReactHooksImport() {\n        return `import * as OffixReactHooks from \"react-offix-hooks\";`;\n    }\n    getDocumentNodeVariable(node, documentVariableName) {\n        return this.config.documentMode === DocumentMode.external ? `Operations.${node.name.value}` : documentVariableName;\n    }\n    getImports() {\n        const baseImports = super.getImports({ excludeFragments: true });\n        const hasOperations = this._collectedOperations.length > 0;\n        if (!hasOperations) {\n            return baseImports;\n        }\n        return [...baseImports, ...Array.from(this.imports)];\n    }\n    _buildHooks(node, operationType, documentVariableName, operationResultType, operationVariablesTypes) {\n        var _a, _b;\n        const operationName = this.convertName((_b = (_a = node.name) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : '', {\n            useTypesPrefix: false,\n        });\n        this.imports.add(this.getOffixReactHooksImport());\n        const hookFns = [];\n        if (operationType === 'Mutation') {\n            hookFns.push(`export function useOffline${operationName}(baseOptions?: OffixReactHooks.${operationType}HookOptions<${operationResultType}, ${operationVariablesTypes}>) {\n    return OffixReactHooks.useOfflineMutation<${operationResultType}, ${operationVariablesTypes}>(${this.getDocumentNodeVariable(node, documentVariableName)}, baseOptions);\n}`);\n        }\n        return [...hookFns].join('\\n');\n    }\n    buildOperation(node, documentVariableName, operationType, operationResultType, operationVariablesTypes) {\n        operationResultType = this._externalImportPrefix + operationResultType;\n        operationVariablesTypes = this._externalImportPrefix + operationVariablesTypes;\n        const hooks = this._buildHooks(node, operationType, documentVariableName, operationResultType, operationVariablesTypes);\n        return [hooks].filter(a => a).join('\\n');\n    }\n    OperationDefinition(node) {\n        if (!node.name || !node.name.value) {\n            return null;\n        }\n        this._collectedOperations.push(node);\n        const documentVariableName = this.convertName(node, {\n            suffix: this.config.documentVariableSuffix,\n            prefix: this.config.documentVariablePrefix,\n            useTypesPrefix: false,\n        });\n        const operationType = pascalCase(node.operation);\n        const operationTypeSuffix = this.getOperationSuffix(node, operationType);\n        const operationResultType = this.convertName(node, {\n            suffix: operationTypeSuffix + this._parsedConfig.operationResultSuffix,\n        });\n        const operationVariablesTypes = this.convertName(node, {\n            suffix: operationTypeSuffix + 'Variables',\n        });\n        const additional = this.buildOperation(node, documentVariableName, operationType, operationResultType, operationVariablesTypes);\n        return [additional].filter(a => a).join('\\n');\n    }\n}\n//# sourceMappingURL=visitor.js.map","import { visit, concatAST, Kind } from 'graphql';\nimport { ReactApolloVisitor } from './visitor';\nimport { extname } from 'path';\nexport const plugin = (schema, documents, config) => {\n    const allAst = concatAST(documents.map(v => v.document));\n    const allFragments = [\n        ...allAst.definitions.filter(d => d.kind === Kind.FRAGMENT_DEFINITION).map(fragmentDef => ({\n            node: fragmentDef,\n            name: fragmentDef.name.value,\n            onType: fragmentDef.typeCondition.name.value,\n            isExternal: false,\n        })),\n        ...(config.externalFragments || []),\n    ];\n    const visitor = new ReactApolloVisitor(schema, allFragments, config, documents);\n    const visitorResult = visit(allAst, { leave: visitor });\n    return {\n        prepend: visitor.getImports(),\n        content: [...visitorResult.definitions.filter(t => typeof t === 'string')].join('\\n'),\n    };\n};\nexport const validate = async (_schema, _documents, _config, outputFile) => {\n    if (extname(outputFile) !== '.tsx' && extname(outputFile) !== '.ts') {\n        throw new Error(`Plugin \"react-apollo\" requires extension to be \".tsx\" or \".ts!`);\n    }\n};\nexport { ReactApolloVisitor };\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}