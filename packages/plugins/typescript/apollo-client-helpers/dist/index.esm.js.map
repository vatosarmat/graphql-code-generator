{"version":3,"file":"index.esm.js","sources":["../../../dist/plugins/typescript/apollo-client-helpers/src/index.js"],"sourcesContent":["import { isInterfaceType, isObjectType } from 'graphql';\nimport { extname } from 'path';\nexport const plugin = (schema, documents, config) => {\n    const results = [];\n    results.push(generateTypePoliciesSignature(schema, config));\n    return {\n        prepend: results.reduce((prev, r) => [...prev, ...(r.prepend || [])], []),\n        append: results.reduce((prev, r) => [...prev, ...(r.append || [])], []),\n        content: results.map(r => r.content).join('\\n'),\n    };\n};\nfunction generateTypePoliciesSignature(schema, config) {\n    var _a, _b, _c;\n    const typeMap = schema.getTypeMap();\n    const perTypePolicies = [];\n    const typedTypePolicies = Object.keys(typeMap).reduce((prev, typeName) => {\n        const type = typeMap[typeName];\n        if (!typeName.startsWith('__') && (isObjectType(type) || isInterfaceType(type))) {\n            const fieldsNames = Object.keys(type.getFields()).filter(f => !f.startsWith('__'));\n            const keySpecifierVarName = `${typeName}KeySpecifier`;\n            const fieldPolicyVarName = `${typeName}FieldPolicy`;\n            perTypePolicies.push(`export type ${keySpecifierVarName} = (${fieldsNames\n                .map(f => `'${f}'`)\n                .join(' | ')} | ${keySpecifierVarName})[];`);\n            perTypePolicies.push(`export type ${fieldPolicyVarName} = {\n${fieldsNames.map(fieldName => `\\t${fieldName}?: FieldPolicy<any> | FieldReadFunction<any>`).join(',\\n')}\n};`);\n            return {\n                ...prev,\n                [typeName]: `{\n\\t\\tkeyFields${config.requireKeyFields ? '' : '?'}: false | ${keySpecifierVarName} | (() => undefined | ${keySpecifierVarName}),\n\\t\\tqueryType?: true,\n\\t\\tmutationType?: true,\n\\t\\tsubscriptionType?: true,\n\\t\\tfields?: ${fieldPolicyVarName},\n\\t}`,\n            };\n        }\n        return prev;\n    }, {});\n    const rootTypes = [\n        (_a = schema.getQueryType()) === null || _a === void 0 ? void 0 : _a.name,\n        (_b = schema.getMutationType()) === null || _b === void 0 ? void 0 : _b.name,\n        (_c = schema.getSubscriptionType()) === null || _c === void 0 ? void 0 : _c.name,\n    ].filter(Boolean);\n    const rootContent = `export type TypedTypePolicies = TypePolicies & {${Object.keys(typedTypePolicies)\n        .map(typeName => {\n        const nonOptional = config.requirePoliciesForAllTypes && !rootTypes.includes(typeName);\n        return `\\n\\t${typeName}${nonOptional ? '' : '?'}: ${typedTypePolicies[typeName]}`;\n    })\n        .join(',')}\\n};`;\n    return {\n        prepend: [\n            `import ${config.useTypeImports ? 'type ' : ''}{ FieldPolicy, FieldReadFunction, TypePolicies } from '@apollo/client/cache';`,\n        ],\n        content: [...perTypePolicies, rootContent].join('\\n'),\n    };\n}\nexport const validate = async (schema, documents, config, outputFile) => {\n    if (extname(outputFile) !== '.ts' && extname(outputFile) !== '.tsx') {\n        throw new Error(`Plugin \"apollo-client-helpers\" requires extension to be \".ts\" or \".tsx\"!`);\n    }\n};\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}